(function(){var a=require("Storage").readJSON("health.json",1)||{},f=0|a.hrm,e=a.hrmMinConfidence;1==f||2==f?(a=function(){Bangle.setHRMPower(1,"health");setTimeout(function(){return Bangle.setHRMPower(0,"health")},6E4*f);if(1==f)for(var b=1;2>=b;b++)setTimeout(function(){Bangle.setHRMPower(1,"health");setTimeout(function(){Bangle.setHRMPower(0,"health")},2E5*b+6E4)},2E5*b)},Bangle.on("health",a),Bangle.on("HRM",function(b){b.confidence>=e&&Bangle.setHRMPower(0,"health")}),Bangle.getHealthStatus().bpmConfidence||
a()):Bangle.setHRMPower(0!=f,"health")})();Bangle.on("health",function(a){function f(c){return String.fromCharCode(c.steps>>8,c.steps&255,c.bpm,Math.min(c.movement/8,255))}var e=new Date(Date.now()-59E4),b=function(c){return 145*(c.getDate()-1)+6*c.getHours()+(0|6*c.getMinutes()/60)}(e);e=function(c){return"health-"+c.getFullYear()+"-"+(c.getMonth()+1)+".raw"}(e);var g=require("Storage").read(e);if(g){var d=g.substr(8+4*b,4);if("\u00ff\u00ff\u00ff\u00ff"!=d){print("HEALTH ERR: Already written!");
return}}else require("Storage").write(e,"HEALTH1\x00",0,17988);var h=8+4*b;require("Storage").write(e,f(a),h,17988);if(143==b%145)if(b=h+4,"\u00ff\u00ff\u00ff\u00ff"!=g.substr(b,4))print("HEALTH ERR: Daily summary already written!");else{a={steps:0,bpm:0,movement:0,movCnt:0,bpmCnt:0};for(var k=0;144>k;k++)d=g.substr(h,4),"\u00ff\u00ff\u00ff\u00ff"!=d&&(a.steps+=(d.charCodeAt(0)<<8)+d.charCodeAt(1),a.movement+=d.charCodeAt(2),a.movCnt++,d=d.charCodeAt(2),a.bpm+=d,d&&a.bpmCnt++),h-=4;a.bpmCnt&&(a.bpm/=
a.bpmCnt);a.movCnt&&(a.movement/=a.movCnt);require("Storage").write(e,f(a),b,17988)}})