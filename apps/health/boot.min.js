(function(){var a=require("Storage").readJSON("health.json",1)||{},k=0|a.hrm,b=a.hrmMinConfidence;if(1==k||2==k){function h(){Bangle.setHRMPower(1,"health");setTimeout(()=>Bangle.setHRMPower(0,"health"),6E4*k);if(1==k)for(var c=1;2>=c;c++)setTimeout(()=>{Bangle.setHRMPower(1,"health");setTimeout(()=>{Bangle.setHRMPower(0,"health")},2E5*c+6E4)},2E5*c)}Bangle.on("health",h);Bangle.on("HRM",c=>{c.confidence>=b&&Bangle.setHRMPower(0,"health")});Bangle.getHealthStatus().bpmConfidence>=b||h()}else Bangle.setHRMPower(0!=
k,"health")})();(function(){function a(){var d=Bangle.getHealthStatus();if(!(Bangle.isCharging()||d.movement<=r)){d=new Date;var m=d.getHours();if(k(m)){m=Bangle.getHealthStatus("day");if(m.steps-l.stepsOnDate>=t||m.steps<l.stepsOnDate)l.stepsOnDate=m.steps,l.stepsDate=d,n.idlSaveData(l);n.idlMustAlert(l,b)&&(g.clear(),n.vibrate(),E.showMessage("Time to move a little!",{title:"Idle alert!"}),setTimeout(load,5E3))}}}function k(d){let m=!1;p&&(m=q<e?d>=q&&d<e:d>=q||d<e);if(!m)return c<f?d>=c&&d<f:d>=
c||d<f}const b=require("Storage").readJSON("health.json",1)||{};let h=b.idleEnabled,c=b.idleStartHour,f=b.idleEndHour,p=b.idleDND,q=b.idleDNDStartHour,e=b.idleDNDEndHour,u=b.idlePollInterval,r=b.idleNoMoveThresh,t=b.idleMinSteps;const n=require("health");let l=n.idlLoadData();l.firstLoad&&(l.firstLoad=!1,n.idlSaveData(l));Bangle.on("midnight",function(){let d=(new Date).getHours();h&&k(d)&&(l.stepsOnDate=0,n.idlSaveData(l))});h&&setInterval(a,6E4*u)})();Bangle.on("health",a=>{function k(e){return String.fromCharCode(e.steps>>
8,e.steps&255,e.bpm,Math.min(e.movement/8,255))}var b=new Date(Date.now()-59E4),h=function(e){return 145*(e.getDate()-1)+6*e.getHours()+(0|6*e.getMinutes()/60)}(b);b=function(e){return"health-"+e.getFullYear()+"-"+(e.getMonth()+1)+".raw"}(b);var c=require("Storage").read(b);if(c){var f=c.substr(8+4*h,4);if("\u00ff\u00ff\u00ff\u00ff"!=f){print("HEALTH ERR: Already written!");return}}else require("Storage").write(b,"HEALTH1\x00",0,17988);var p=8+4*h;require("Storage").write(b,k(a),p,17988);if(143==
h%145)if(h=p+4,"\u00ff\u00ff\u00ff\u00ff"!=c.substr(h,4))print("HEALTH ERR: Daily summary already written!");else{a={steps:0,bpm:0,movement:0,movCnt:0,bpmCnt:0};for(var q=0;144>q;q++)f=c.substr(p,4),"\u00ff\u00ff\u00ff\u00ff"!=f&&(a.steps+=(f.charCodeAt(0)<<8)+f.charCodeAt(1),a.movement+=f.charCodeAt(2),a.movCnt++,f=f.charCodeAt(2),a.bpm+=f,f&&a.bpmCnt++),p-=4;a.bpmCnt&&(a.bpm/=a.bpmCnt);a.movCnt&&(a.movement/=a.movCnt);require("Storage").write(b,k(a),h,17988)}})